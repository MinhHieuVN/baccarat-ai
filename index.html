<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Baccarat AI VIP</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  background:#0b0f1a;
  font-family:Arial, sans-serif;
  color:#fff;
  padding:20px;
}
#panel{
  max-width:420px;
  margin:auto;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  border-radius:20px;
  box-shadow:0 0 30px #00e5ff;
  padding:20px;
}
h2{
  text-align:center;
  margin-top:0;
}
select{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:none;
  font-size:16px;
  margin-bottom:15px;
}
#predict{
  text-align:center;
  font-size:26px;
  font-weight:bold;
  padding:20px;
  border-radius:15px;
  background:#000;
  box-shadow:inset 0 0 15px #00e5ff;
}
.bank{ color:#00ff99; }
.player{ color:#ff5252; }
#status{
  text-align:center;
  font-size:13px;
  opacity:0.85;
  margin-top:10px;
}
</style>
</head>

<body>

<div id="panel">
  <h2>ü§ñ BACCARAT AI VIP</h2>

  <select id="tableSelect"></select>

  <div id="predict">--</div>
  <div id="status">ƒêang t·∫£i d·ªØ li·ªáu...</div>
</div>

<script>
const API_URL =
 "https://api.allorigins.win/raw?url=https://bcrapj-9ska.onrender.com/sexy/all";

let tables = [];

/* ================= AI LEVEL 2 (FIX TIE) ================= */
function aiPredict(historyRaw){
  // b·ªè T (Tie)
  const history = historyRaw
    .split("")
    .filter(x => x === "B" || x === "P");

  if(history.length < 6){
    return { result:"BANKER", conf:50 };
  }

  let scoreB = 0, scoreP = 0;

  // 1Ô∏è‚É£ T·ªïng l·ª±c
  let b = 0, p = 0;
  history.forEach(x=>{
    if(x==="B") b++;
    if(x==="P") p++;
  });
  b > p ? scoreB+=2 : scoreP+=2;

  // 2Ô∏è‚É£ C·∫ßu b·ªát (5 v√°n cu·ªëi)
  const last5 = history.slice(-5);
  if(last5.every(x=>x==="B")) scoreB+=3;
  if(last5.every(x=>x==="P")) scoreP+=3;

  // 3Ô∏è‚É£ C·∫ßu ƒë·∫£o (4 gi·ªëng nhau)
  const last4 = history.slice(-4);
  if(last4.every(x=>x==="B")) scoreP+=2;
  if(last4.every(x=>x==="P")) scoreB+=2;

  // 4Ô∏è‚É£ C·∫ßu 1-1
  const last10 = history.slice(-10);
  let zigzag = true;
  for(let i=1;i<last10.length;i++){
    if(last10[i]===last10[i-1]) zigzag=false;
  }
  if(zigzag){
    history[history.length-1]==="B"
      ? scoreP+=2 : scoreB+=2;
  }

  const result = scoreB >= scoreP ? "BANKER" : "PLAYER";
  const conf = Math.min(90, Math.abs(scoreB-scoreP)*15 + 55);

  return { result, conf };
}

/* ================= UPDATE UI ================= */
function updatePrediction(){
  const idx = document.getElementById("tableSelect").value;
  const table = tables[idx];
  if(!table) return;

  const ai = aiPredict(table.ket_qua);
  const box = document.getElementById("predict");

  box.innerHTML =
    `ü§ñ ${ai.result}<br><small>ƒê·ªô tin c·∫≠y ${ai.conf}%</small>`;
  box.className = ai.result === "BANKER"
    ? "bank" : "player";
}

/* ================= LOAD API ================= */
async function loadTables(){
  try{
    const res = await fetch(API_URL);
    tables = await res.json();

    const select = document.getElementById("tableSelect");
    select.innerHTML = "";

    tables.forEach((t,i)=>{
      const opt = document.createElement("option");
      opt.value = i;
      opt.textContent = "B√†n " + t.ban;
      select.appendChild(opt);
    });

    document.getElementById("status").textContent =
      "ƒê√£ t·∫£i " + tables.length + " b√†n";
    updatePrediction();

  }catch(err){
    document.getElementById("status").textContent =
      "‚ùå Kh√¥ng k·∫øt n·ªëi ƒë∆∞·ª£c API";
    console.error(err);
  }
}

document.getElementById("tableSelect")
  .addEventListener("change", updatePrediction);

loadTables();
setInterval(loadTables, 15000);
</script>

</body>
</html>
